<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airtnt.airtnt.service.PropertyMapper">

<resultMap type="propertyDTO" id="propertyMap">
	<id property="id" column="id" />
	<result property="name" column="name"/>
	<result property="hostId" column="host_id"/>
	<result property="propertyDesc" column="property_desc"/>
	<result property="address" column="address"/>
	<result property="latitude" column="latitude"/>
	<result property="longitude" column="longitude"/>
	<result property="price" column="price"/>
	<result property="bedCount" column="bed_count"/>
	<result property="maxGuest" column="max_guest"/>
	<result property="regDate" column="reg_date"/>
	<result property="modDate" column="mod_date"/>
	
	<association property="propertyType" column="property_type_id"
		columnPrefix="property_type_" resultMap="propertyTypeMap"/>
	
	<association property="subPropertyType" column="sub_property_type_id"
		columnPrefix="sub_property_type_" resultMap="subPropertyTypeMap"/>
	
	<association property="roomType" column="room_type_id"
		columnPrefix="room_type_" resultMap="roomTypeMap"/>
	
	<collection property="amenities" ofType="amenityDTO"
		columnPrefix="amenity_" resultMap="amenityMap"/>
	
	<collection property="images" ofType="imageDTO"
		columnPrefix="image_" resultMap="imageMap"/>
	
</resultMap>

<resultMap type="propertyTypeDTO" id="propertyTypeMap">
	<id property="id" column="id"/>
	<result property="name" column="name"/>
	<result property="isUse" column="is_use"/>
	<result property="regDate" column="reg_date"/>
	<result property="modDate" column="mod_date"/>
</resultMap>

<resultMap type="subPropertyTypeDTO" id="subPropertyTypeMap">
	<id property="id" column="id"/>
	<result property="propertyTypeId" column="property_type_id"/>
	<result property="name" column="name"/>
	<result property="isUse" column="is_use"/>
	<result property="regDate" column="reg_date"/>
	<result property="modDate" column="mod_date"/>
</resultMap>

<resultMap type="roomTypeDTO" id="roomTypeMap">
	<id property="id" column="id"/>
	<result property="name" column="name"/>
	<result property="isUse" column="is_use"/>
	<result property="regDate" column="reg_date"/>
	<result property="modDate" column="mod_date"/>
</resultMap>

<resultMap type="amenityDTO" id="amenityMap">
	<id property="id" column="id"/>
	<result property="propertyId" column="property_id"/>
	<association property="amenityType" column="amenity_type_id"
	columnPrefix="type_" resultMap="amenityTypeMap"/>
</resultMap>

<resultMap type="amenityTypeDTO" id="amenityTypeMap">
	<id property="id" column="id"/>
	<result property="name" column="name"/>
	<result property="isUse" column="is_use"/>
	<result property="regDate" column="reg_date"/>
	<result property="modDate" column="mod_date"/>
</resultMap>

<resultMap type="imageDTO" id="imageMap">
	<id property="id" column="id"/>
	<result property="propertyId" column="property_id"/>
	<result property="isMain" column="is_main"/>
	<result property="path" column="path"/>
	<result property="fileSize" column="file_size"/>
	<result property="regDate" column="reg_date"/>
	<result property="modDate" column="mod_date"/>
</resultMap>

<resultMap type="bookingDTO" id="bookingMap">
	<id column="id" property="id"/>
	<result column="property_id" property="propertyId"/>
	<result column="guest_id" property="guestId"/>
	<result column="host_id" property="hostId"/>
	<result column="guest_count" property="guestCount"/>
	<result column="day_count" property="dayCount"/>
	<result column="total_price" property="totalPrice"/>
	<result column="booking_number" property="bookingNumber"/>
	<result column="check_in_date" property="checkInDate"/>
	<result column="check_out_date" property="checkOutDate"/>
	<result column="confirm_date" property="confirmDate"/>
	<result column="reg_date" property="regDate"/>
	<result column="mod_date" property="modDate"/>
</resultMap>

<select id="searchPropertiesByAddress" parameterType="String" resultMap="propertyMap">
select p.*,

pt.id property_type_id,
pt.name property_type_name,
pt.is_use property_type_is_use,
pt.reg_date property_type_reg_date,
pt.mod_date property_type_mod_date,

spt.id sub_property_type_id,
spt.property_type_id,
spt.name sub_property_type_name,
spt.is_use sub_property_type_is_use,
spt.reg_date sub_property_type_reg_date,
spt.mod_date sub_property_type_mod_date,

rt.id room_type_id,
rt.name room_type_name,
rt.is_use room_type_is_use,
rt.reg_date room_type_reg_date,
rt.mod_date room_type_mod_date,

a.id amenity_id,
a.property_id amenity_property_id,

at.id amenity_type_id,
at.name amenity_type_name,
at.is_use amenity_type_is_use,
at.reg_date amenity_type_reg_date,
at.mod_date amenity_type_mod_date,

i.id image_id,
i.property_id image_property_id,
i.is_main image_is_main,
i.path image_path,
i.file_size image_file_size,
i.reg_date image_reg_date,
i.mod_date image_mod_date

from property p, property_type pt, sub_property_type spt, room_type rt,
amenity a, amenity_type at, image i

where p.address like #{addressKey}
and p.property_type_id=pt.id and p.sub_property_type_id=spt.id and p.room_type_id=rt.id
and a.property_id=p.id and a.amenity_type_id=at.id and at.is_use='Y'
and i.property_id=p.id
</select>

<select id="selectPropertyById" parameterType="int" resultMap="propertyMap">
select p.*,

pt.id property_type_id,
pt.name property_type_name,
pt.is_use property_type_is_use,
pt.reg_date property_type_reg_date,
pt.mod_date property_type_mod_date,

spt.id sub_property_type_id,
spt.property_type_id,
spt.name sub_property_type_name,
spt.is_use sub_property_type_is_use,
spt.reg_date sub_property_type_reg_date,
spt.mod_date sub_property_type_mod_date,

rt.id room_type_id,
rt.name room_type_name,
rt.is_use room_type_is_use,
rt.reg_date room_type_reg_date,
rt.mod_date room_type_mod_date,

a.id amenity_id,
a.property_id amenity_property_id,

at.id amenity_type_id,
at.name amenity_type_name,
at.is_use amenity_type_is_use,
at.reg_date amenity_type_reg_date,
at.mod_date amenity_type_mod_date,

i.id image_id,
i.property_id image_property_id,
i.is_main image_is_main,
i.path image_path,
i.file_size image_file_size,
i.reg_date image_reg_date,
i.mod_date image_mod_date

from property p, property_type pt, sub_property_type spt, room_type rt,
amenity a, amenity_type at, image i

where p.id=#{propertyId}
and p.property_type_id=pt.id and p.sub_property_type_id=spt.id and p.room_type_id=rt.id
and a.property_id=p.id and a.amenity_type_id=at.id and at.is_use='Y'
and i.property_id=p.id
</select>

<select id="selectPropertyTypes" resultMap="propertyTypeMap">
select * from property_type
</select>

<select id="selectSubPropertyTypes" resultMap="subPropertyTypeMap">
select * from sub_property_type
</select>

<select id="selectRoomTypes" resultMap="roomTypeMap">
select * from property_type
</select>

<select id="selectImages" resultMap="imageMap">
select * from image
</select>

<select id="selectAmenityType" parameterType="int" resultMap="amenityTypeMap">
select * from amenity_type where amenity_type_id=#{amenityTypeId}
</select>

<select id="selectAmenities" parameterType="int" resultMap="amenityMap">
select
a.*,

at.id type_id,
at.name type_name,
at.is_use type_is_use,
at.reg_date type_reg_date,
at.mod_date type_mod_date

from amenity a, amenity_type at
where a.property_id=#{propertyId} and a.amenity_type_id=at.id
and at.is_use='Y'
</select>

</mapper>